<%= simple_form_for @booking do |f| %>
  <%= f.input :start_date, as: :string, input_html: { class: 'datepicker' } %>
  <%= f.input :end_date, as: :string, input_html: { class: 'datepicker' } %>
  <%= f.input :totalprice, input_html: { readonly: true } %>
  <%= f.input :daily_rate, input_html: { id: 'booking_daily_rate', readonly: true, value: @daily_rate } %>
  <%= f.button :submit %>
<% end %>

<script>
  $(document).ready(function() {
    $('#car_id').change(function() {
      var carId = $(this).val();
      $.ajax({
        url: '/cars/' + carId + '/get_daily_rate',
        type: 'GET',
        success: function(response) {
          $('#booking_daily_rate').val(response.daily_rate);
          updateTotal();
        },
        error: function() {
          console.log('Error fetching daily rate');
        }
      });
    });

    $('.datepicker').datepicker({
      dateFormat: 'dd-mm-yy',
      onSelect: function(dateText, inst) {
        updateTotal();
      }
    });

    function updateTotal() {
      let startDate = $("#booking_start_date").datepicker("getDate");
      let endDate = $("#booking_end_date").datepicker("getDate");
      let dailyRate = parseFloat($("#booking_daily_rate").val());

      if (!isNaN(startDate) && !isNaN(endDate) && !isNaN(dailyRate)) {
        let days = Math.floor((endDate - startDate) / (24 * 60 * 60 * 1000));
        let totalPrice = days * dailyRate;
        $('#booking_totalprice').val(totalPrice.toFixed(2));
      }
    }
  });
</script>
